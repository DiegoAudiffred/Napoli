{% extends 'layout/layout.html' %}
{% load static %}
{% block body %}


<div class="container min-vh-100 px-4 my-4">
        <div class="row">
        <div class="col-xl-3 col-md-4 col-12 my-auto">
            <h1 class="text-quinto">Ventas</h1>
            
        </div>
    
        {% if user.rol == "Admin" or user.rol == "Dueña/o"%}

        <div class="col-xl-2 col-md-4 col-6 my-auto">
            <a href="{% url 'Ventas:ventasTodas'%}"> <button class="btn rounded rounded-3  bg-quinto text-white w-100 py-2">Buscar
            Venta</button> </a>
        </div>



        {% endif %}

    </div>

    <div class="row">
<div class="col-2">
      {% if 26 in mesasEnUso2%}   
          
            <a href="{% url 'Ventas:modificarVenta' 0 %}" class="btn border border-3 mb-3 bg-corporateYellow800 text-white w-100" id="mesa26"
                style=" display: flex;  align-items: center;  justify-content: center;">
                <b>Para llevar 1</b>
            </a>
           
             {% else %}
                <form action=" {% url 'Ventas:ventasCrearMesa' 'Para llevar 1'%}" method="POST" enctype="multipart/form-data"
                    id="user-profile-form">
                    {% csrf_token %}
                    <button class="btn border border-3 mb-3 bg-primary text-white w-100"  id="mesa26"> <!-- Mesa8B -->
                        <b>Para llevar 1</b>
                    </button>
                </form>
            {% endif %}
           

</div>
<div class="col-2">
  {% if 27 in mesasEnUso2%}   
          
            <a href="{% url 'Ventas:modificarVenta' 0 %}" class="btn border border-3 mb-3 bg-corporateYellow800 text-white w-100" id="mesa27"
                style=" display: flex;  align-items: center;  justify-content: center;">
                <b>Para llevar 2</b>
            </a>
           
             {% else %}
                <form action=" {% url 'Ventas:ventasCrearMesa' 'Para llevar 2'%}" method="POST" enctype="multipart/form-data"
                    id="user-profile-form">
                    {% csrf_token %}
                    <button class="btn border border-3 mb-3 bg-primary text-white w-100"  id="mesa27"> <!-- Mesa8B -->
                        <b>Para llevar 2</b>
                    </button>
                </form>
            {% endif %}
        
</div>
<div class="col-2">
     {% if 28 in mesasEnUso2%}   
          
            <a href="{% url 'Ventas:modificarVenta' 0 %}" class="btn border border-3 mb-3 bg-corporateYellow800 text-white w-100" id="mesa28"
                style=" display: flex;  align-items: center;  justify-content: center;">
                <b>Para llevar 3</b>
            </a>
           
             {% else %}
                <form action=" {% url 'Ventas:ventasCrearMesa' 'Para llevar 3'%}" method="POST" enctype="multipart/form-data"
                    id="user-profile-form">
                    {% csrf_token %}
                    <button class="btn border border-3 mb-3 bg-primary text-white w-100"  id="mesa28"> <!-- Mesa8B -->
                        <b>Para llevar 3</b>
                    </button>
                </form>
            {% endif %}
               
</div>
<div class="col-2">
     {% if 30 in mesasEnUso2%}   
          
            <a href="{% url 'Ventas:modificarVenta' 0 %}" class="btn border border-3 mb-3 bg-corporateYellow800 text-white w-100" id="mesa30"
                style=" display: flex;  align-items: center;  justify-content: center;">
                <b>Para llevar 4</b>
            </a>
           
             {% else %}
                <form action=" {% url 'Ventas:ventasCrearMesa' 'Para llevar 4'%}" method="POST" enctype="multipart/form-data"
                    id="user-profile-form">
                    {% csrf_token %}
                    <button class="btn border border-3 mb-3 bg-primary text-white w-100"  id="mesa30"> <!-- Mesa8B -->
                        <b>Para llevar 4</b>
                    </button>
                </form>
            {% endif %}
               
</div>

<div class="col-2">
     {% if 31 in mesasEnUso2%}   
          
            <a href="{% url 'Ventas:modificarVenta' 0 %}" class="btn border border-3 mb-3 bg-corporateYellow800 text-white w-100" id="mesa31"
                style=" display: flex;  align-items: center;  justify-content: center;">
                <b>Para llevar 5</b>
            </a>
           
             {% else %}
                <form action=" {% url 'Ventas:ventasCrearMesa' 'Para llevar 5'%}" method="POST" enctype="multipart/form-data"
                    id="user-profile-form">
                    {% csrf_token %}
                    <button class="btn border border-3 mb-3 bg-primary text-white w-100"  id="mesa31"> <!-- Mesa8B -->
                        <b>Para llevar 5</b>
                    </button>
                </form>
            {% endif %}
               
</div>

 <div class="col-2">
  {% if 29 in mesasEnUso2%}   
          
            <a href="{% url 'Ventas:modificarVenta' 0 %}" class="btn border border-3 mb-3 bg-corporateYellow800 text-white" id="mesa29"
                style="width: 100px;height: 100px; display: flex;  align-items: center;  justify-content: center;">
                <b>Donaciones</b>
            </a>
           
             {% else %}
                <form action=" {% url 'Ventas:ventasCrearMesa' 'Donaciones'%}" method="POST" enctype="multipart/form-data"
                    id="user-profile-form">
                    {% csrf_token %}
                    <button class="btn border border-3 mb-3 bg-primary text-white w-100"  id="mesa29"> <!-- Mesa8B -->
                        <b>Donaciones</b>
                    </button>
                </form>
            {% endif %}
                </div>
    </div>
                    {% include 'Ventas/map.html' %}


</div>
<!-- 
    <div class="container min-vh-100 px-4">
    <div class="col-xl-2 col-md-4 col-6 my-auto">
            <form action=" " method="POST" enctype="multipart/form-data"
                id="user-profile-form"> <!-- { url 'Ventas:ventasCrear' user.id} 
                {% csrf_token %}
                <button class="btn rounded rounded-3  bg-tercero text-white w-100 py-2" type="submit">Crear
                    Venta </button>

            </form>
        </div>
    <div class="row">

        {% for venta in ventas %}

        <div class="col-12  col-lg-6 col-xl-3 my-3">
            <div class="card rounded rounded-4 border border-secondary bg-white">
                <div class=" card-body text-quinto">
                    <p class=" card-text ">Cliente: {% if venta.cliente.nombre %} {{venta.cliente.nombre}}
                        {% else %} Por
                        asignar {% endif %}</p>
                    <p class="card-text">Mesa: {{venta.mesa }} </p>

                    <p class="card-text">Empleado: {% if venta.empleado.first_name %} {{venta.empleado.first_name}}
                        {% else %} Por
                        asignar {% endif %}</p>
                    <p class="card-text">Fecha: {{venta.fecha_compra|date:"[d - M / H:i]"}} </p>
                    
                    <p class="card-text">Total de venta: ${% if venta.total is None %} 0 {% else %} {{venta.total}}
                        {% endif %} mxn
                    </p>

                    <div class="row">
                        <div class="col-6">
                            <a href="{% url 'Ventas:modificarVenta' venta.id %}"
                                class="card-link btn w-100 text-white btn-tercero">Modificar
                            </a>
                        </div>
                        <div class="col-6">

                            <form action="{% url 'Ventas:cerrarVenta' venta.id %}" method="POST"
                                enctype="multipart/form-data" id="user-profile-form">
                                {% csrf_token %}
                                <a class="card-link btn w-100 btn-secondary" data-bs-toggle="modal"
                                    data-bs-target="#exampleModal{{venta.id}}">Cerrar</a>

                                <div class="modal fade" id="exampleModal{{venta.id}}" tabindex="-1"
                                    aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content bg-cuarto">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel">¿Esta seguro de
                                                    cerrar la cuenta de
                                                    {{venta.cliente.nombre}} ?</h5>

                                            </div>

                                            <div class="modal-body">
                                                <button type="button" class="btn btn-tercero text-white "
                                                    data-bs-dismiss="modal">Cancelar</button>
                                                <button type="submit" class="btn btn-secondary">Cerrar cuenta</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class=" col-sm-12 my-3">
            <h2>No hay ventas abiertas por el momento </h2>
        </div>
        {% endfor %}

       
    </div>

</div>
 -->

<script>
window.onload = function() {
   var listaTuplas = [
            {% for tupla in mesasEnUso %}
                [{{ tupla.0 }}, {{ tupla.1 }}],
            {% endfor %}
        ];
        for (var i = 0; i < listaTuplas.length; i++) {
            console.log(listaTuplas[i]);
        }
        
var modificarVentaUrl=""
    for(var i = 0; i < listaTuplas.length;i++){
        enlaceMesa = document.getElementById('mesa'+listaTuplas[i][0])
        modificarVentaUrl = "{% url 'Ventas:modificarVenta' 999 %}".replace("999", listaTuplas[i][1]);
        enlaceMesa.href = modificarVentaUrl

       
    
    }    



};

    
</script>

{% endblock %}
